var v=Object.defineProperty;var S=(n,t,e)=>t in n?v(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>(S(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const h of s.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function e(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=e(a);fetch(a.href,s)}})();const E=(n,t)=>{const e=n.indexOf(t);e>-1&&n.splice(e,1)};class o{constructor(t,e){r(this,"x");r(this,"y");this.x=t,this.y=e}plus(t){return new o(this.x+t.x,this.y+t.y)}minus(t){return new o(this.x-t.x,this.y-t.y)}multiply(t){return new o(this.x*t,this.y*t)}divide(t){return new o(this.x/t,this.y/t)}half(){return this.multiply(.5)}snap(t){return new o(Math.round(this.x/t)*t,Math.round(this.y/t)*t)}lengthTo(t){return Math.sqrt((this.x-t.x)**2+(this.y-t.y)**2)}isInside(t,e){return t.x<=this.x&&this.x<=t.x+e.x&&t.y<=this.y&&this.y<=t.y+e.y}moveTowards(t,e){return this.plus(this.direction(t).multiply(e))}direction(t){if(t.y===this.y&&t.x===this.x)return new o(0,0);const e=Math.atan2(t.y-this.y,t.x-this.x);return new o(Math.cos(e),Math.sin(e))}round(){return new o(Math.round(this.x),Math.round(this.y))}equals(t){return this.x===t.x&&this.y==t.y}copy(){return new o(this.x,this.y)}}var x;(function(n){n[n.Left=0]="Left",n[n.Middle=1]="Middle",n[n.Right=2]="Right",n[n.BrowserBack=3]="BrowserBack",n[n.BrowserForward=4]="BrowserForward"})(x||(x={}));const p=new Set,g=new Set,f=new Set;document.addEventListener("keydown",n=>{p.add(n.key)});document.addEventListener("keyup",n=>{g.add(n.key)});const b=n=>{const t=new Set,e=new Set,i=new Set,a=c=>{t.forEach(_=>{i.add(_.button),c.forEach(d=>{d.onMousePress&&d.onMousePress(_)})}),t.clear(),e.forEach(_=>{i.delete(_.button),c.forEach(d=>{d.onMouseRelease&&d.onMouseRelease(_)})}),e.clear(),p.forEach(_=>{f.add(_),c.forEach(d=>{d.onKeyPress&&d.onKeyPress(_)})}),p.clear(),g.forEach(_=>{f.delete(_),c.forEach(d=>{d.onKeyRelease&&d.onKeyRelease(_)})}),g.clear()},s={mouse:{canvasPos:new o(0,0),worldPos:new o(0,0),button:c=>i.has(c)},key:c=>f.has(c),__handleInput:a},h=c=>{const _=n.scale??1;return new o((c.pageX-n.element.offsetLeft)/_,(c.pageY-n.element.offsetTop)/_)};document.addEventListener("mousedown",c=>{t.add({button:c.button,pos:h(c)})}),document.addEventListener("mouseup",c=>{e.add({button:c.button,pos:h(c)})});const l=c=>c.preventDefault();return document.addEventListener("mousemove",c=>{s.mouse.canvasPos=h(c),s.mouse.worldPos=n.camera?n.camera.toWorldPosition(s.mouse.canvasPos):s.mouse.canvasPos;const _=n.scale??1;s.mouse.canvasPos.isInside(new o(0,0),new o(n.element.width/_,n.element.height/_))?document.addEventListener("contextmenu",l):document.removeEventListener("contextmenu",l)}),s};class P{constructor(t){r(this,"__parentElement");r(this,"__canvasElement");r(this,"__ctx");r(this,"__scale");r(this,"camera");r(this,"drawImage",(t,e,i,a)=>{const s=Object.assign({imageSmoothingEnabled:!1},a);this.withStyleAndPos(s,h=>{t.image&&this.__ctx.drawImage(t.image,h.x,h.y,t.image.width*(i??1),t.image.height*(i??1))},e)});this.__parentElement=t,this.__canvasElement=document.createElement("canvas"),this.__canvasElement.classList.add("gameCanvas"),this.__parentElement.appendChild(this.__canvasElement),this.__ctx=this.__canvasElement.getContext("2d",{alpha:!1})}__getCameraPositionDelta(){var e,i;if(!((e=this.camera)!=null&&e.target))return new o(0,0);const t=this.camera.target.pos.minus(this.camera.posPrev);return this.camera.posPrev=(i=this.camera.target)==null?void 0:i.pos,t}setOptions(t){this.__canvasElement.width=t.width??this.__canvasElement.width,this.__canvasElement.height=t.height??this.__canvasElement.height,this.__scale=t.scale??this.__scale,t.scale&&this.__ctx.scale(t.scale,t.scale)}get element(){return this.__canvasElement}get scale(){return this.__scale}withStyle(t,e){this.__ctx.save(),t.strokeStyle!==void 0&&(this.__ctx.strokeStyle=t.strokeStyle),t.lineWidth!==void 0&&(this.__ctx.lineWidth=t.lineWidth),t.fillStyle!==void 0&&(this.__ctx.fillStyle=t.fillStyle),(t.font!==void 0||t.fontSize!==void 0)&&(this.__ctx.font=`${t.fontSize??8}px ${t.font??"arial"}`),t.imageSmoothingEnabled!=null&&(this.__ctx.imageSmoothingEnabled=t.imageSmoothingEnabled),e(),this.__ctx.restore()}withStyleAndPos(t,e,i){this.withStyle(t,()=>{this.camera&&!t.gui?e(this.camera.toCanvasPosition(i)):e(i)})}withStyleAndPositions(t,e,i){this.withStyle(t,()=>{this.camera&&!t.gui?e(i.map(a=>this.camera.toCanvasPosition(a))):e(i)})}drawRect(t,e,i){const a=Object.assign({fillStyle:"white"},i);this.withStyleAndPos(a,s=>{this.__ctx.fillStyle&&this.__ctx.fillRect(s.x,s.y,e.x,e.y),this.__ctx.strokeStyle&&this.__ctx.strokeRect(s.x,s.y,e.x,e.y)},t)}drawClear(){this.__ctx.clearRect(0,0,this.__canvasElement.width,this.__canvasElement.height)}drawPath(t,e){const i=Object.assign({strokeStyle:"white",lineWidth:1},e);this.withStyleAndPositions(i,a=>{this.__ctx.beginPath(),this.__ctx.moveTo(a[0].x,a[0].y);for(let s=0;s<a.length;s++)this.__ctx.lineTo(a[s].x,a[s].y);this.__ctx.stroke()},t)}drawLine(t,e,i,a){const s=t.copy(),h=e.copy(),l=Math.atan2(h.y-s.y,h.x-s.x);i.startOffset&&(s.x+=i.startOffset*Math.cos(l),s.y+=i.startOffset*Math.sin(l)),i.endOffset&&(h.x+=i.endOffset*Math.cos(l),h.y+=i.endOffset*Math.sin(l));const c=s.lengthTo(h);i.maxLength&&c>i.maxLength?(h.x=s.x+i.maxLength*Math.cos(l),h.y=s.y+i.maxLength*Math.sin(l)):i.minLength&&c<i.minLength&&(h.x=s.x+i.minLength*Math.cos(l),h.y=s.y+i.minLength*Math.sin(l)),this.drawPath([s,h],a)}drawText(t,e,i){const a=Object.assign({fillStyle:"white",font:"arial",fontSize:8},i);this.withStyleAndPos(a,s=>{this.__ctx.fillText(t,s.x,s.y+(a.fontSize??0))},e)}drawCircle(t,e,i){const a=Object.assign({fillStyle:"white"},i);this.withStyleAndPos(a,s=>{this.__ctx.beginPath(),this.__ctx.arc(s.x,s.y,t,0,2*Math.PI),this.__ctx.fillStyle&&this.__ctx.fill(),this.__ctx.strokeStyle&&this.__ctx.stroke()},e)}}const y={width:480,height:320,scale:2,fps:60,zSort:!0,baseUrl:"./"};class O{constructor(t){r(this,"__gameDiv");r(this,"__assetsDiv");r(this,"__options",y);r(this,"__gameObjects",[]);r(this,"__canvas");r(this,"__t",0);r(this,"__input");r(this,"beforeDraw");r(this,"afterDraw");r(this,"beforeStep");r(this,"afterStep");r(this,"currentFps",0);if(!t)throw new Error("Element passed to Game() is null!");if(!(t instanceof HTMLDivElement))throw new Error("Element passed to Game() is not an HTMLDivElement!");this.__gameDiv=t,this.__canvas=new P(this.__gameDiv),this.__assetsDiv=document.createElement("div"),this.__assetsDiv.hidden=!0,this.__gameDiv.appendChild(this.__assetsDiv),this.setOptions(y),this.__input=b(this.__canvas)}setOptions(t){this.__options={...this.__options,...t};const e=this.getCanvasSize().multiply(this.__options.scale);return this.__canvas.setOptions({width:e.x,height:e.y,scale:this.__options.scale}),this}get options(){return{...this.__options}}get canvas(){return this.__canvas}getCanvasSize(){return new o(this.__options.width,this.__options.height)}getGameObjectCount(){return this.__gameObjects.length}__addObject(t){this.__gameObjects.push(t)}__removeObject(t){E(this.__gameObjects,t)}__addAssetElement(t){var e;(e=this.__assetsDiv)==null||e.appendChild(t)}play(){let t=0,e=0;const i=a=>{requestAnimationFrame(i);const s=a-t,h=1e3/this.__options.fps;s>=h&&(t=a-s%h,this.currentFps=1e3/(a-e),e=a,this.__step())};i(0)}__maybeSort(){if(!this.__options.zSort)return;let t=!1;for(let e=0;e<this.__gameObjects.length;e++)if(this.__gameObjects[e].__changed){t=!0;break}t&&(this.__gameObjects.sort((e,i)=>e.__zIndex-i.__zIndex),this.__gameObjects.forEach(e=>e.__changed=!1))}__step(){this.__input.mouse.worldPos.plus(this.__canvas.__getCameraPositionDelta()),this.__maybeSort(),this.__input.__handleInput(this.__gameObjects),this.__canvas.drawClear(),this.beforeDraw&&this.beforeDraw({game:this,canvas:this.__canvas,input:this.__input,t:this.__t}),this.__gameObjects.forEach(t=>{t.draw&&t.draw({game:this,canvas:this.__canvas,input:this.__input,t:this.__t})}),this.afterDraw&&this.afterDraw({game:this,canvas:this.__canvas,input:this.__input,t:this.__t}),this.beforeStep&&this.beforeStep({game:this,input:this.__input,dtFactor:Math.round(this.__options.fps/this.currentFps)}),this.__gameObjects.forEach(t=>{t.step&&t.step({game:this,input:this.__input,dtFactor:Math.round(this.__options.fps/this.currentFps)})}),this.afterStep&&this.afterStep({game:this,input:this.__input,dtFactor:Math.round(this.__options.fps/this.currentFps)}),this.__t++}}class L{constructor(){r(this,"__changed",!0);r(this,"__zIndex",0);r(this,"__game");this.activate()}activate(t){var e;return t&&(this.deactivate(),this.__game=t),(e=this.__game)==null||e.__addObject(this),this}deactivate(){var t;(t=this.__game)==null||t.__removeObject(this)}destruct(){this.deactivate(),this.destructor&&this.destructor()}setZIndex(t){this.__zIndex=t,this.__changed=!0}}class w extends L{constructor(e,i){super();r(this,"pos");this.pos=new o(e,i),this.setZIndex(i)}}class M extends w{constructor(e,i,a,s={}){super(i,a);r(this,"getText");r(this,"drawStyle");this.getText=e,this.drawStyle=s}draw(e){e.canvas.drawText(this.getText(),this.pos,this.drawStyle)}}class m extends w{constructor(){super(...arguments);r(this,"radius",20);r(this,"charge",1)}draw(e){e.canvas.drawCircle(this.radius,this.pos,{fillStyle:this.charge>0?"green":"red"})}}class D extends m{constructor(){super(...arguments);r(this,"acceleration",new o(0,0));r(this,"speed",new o(0,0))}step(e){const a=e.game.__gameObjects.filter(l=>l instanceof m);this.acceleration=new o(0,0);for(const l of a){if(l==this)continue;const c=this.pos.minus(l.pos),_=c.lengthTo(new o(0,0)),d=c.multiply(250*(this.charge*l.charge)/(_*_*_));this.acceleration=this.acceleration.plus(d)}const s=.2;this.acceleration.x=Math.max(-s,Math.min(s,this.acceleration.x)),this.acceleration.y=Math.max(-s,Math.min(s,this.acceleration.y)),this.acceleration.x>s&&console.log(this.acceleration),this.speed=this.speed.plus(this.acceleration.multiply(e.dtFactor)),this.pos=this.pos.plus(this.speed.multiply(e.dtFactor));const h=e.game.getCanvasSize();(this.pos.x<0||h.x<this.pos.x)&&(this.speed.x*=-.7),(this.pos.y<0||h.y<this.pos.y)&&(this.speed.y*=-.7)}}class j extends D{onKeyPress(t){t==" "&&(this.charge*=-1)}}const u=new O(document.querySelector("#app"));new m(50,50).activate(u);new m(200,200).activate(u);new m(400,250).activate(u);new j(300,50).activate(u);new M(()=>`FPS: ${u.currentFps.toFixed(1)}`,8,8).activate(u);u.play();
